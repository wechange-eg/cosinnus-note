{% load i18n static cosinnus_tags widget_tweaks %}


{% if notes %}
    {% for note in notes %}
        <div type="button" class="btn btn-emphasized btn-headline">
            <ul class="media-list">
                <li class="media">
                    <a class="pull-left" href="{{ note.creator.cosinnus_profile.get_absolute_url }}">
                        {% include "cosinnus/user/user_avatar_image.html" with user=note.creator %}
                    </a>
                    <div class="media-body">
                         <a href="{{ note.creator.cosinnus_profile.get_absolute_url }}">{{ note.creator|full_name }}</a> –
                         <span class="moment-data-date" data-date="{{ note.created|date:'c' }}" title="{{ note.created|date:'r' }}"></span>
						 <div class="group-annotation">
						     <i class="fa fa-users"></i>
						     {{ note.group.name }}
						 </div>
                    </div>
                </li>
            </ul>
        </div><!-- btn -->
        <div type="button" class="btn btn-default dashboard-appwidget-contentline-extra-indented">
            <ul class="media-list fine-space">
                <li class="media">
                    <div class="media-body">
                        <div class="well">
                            {{ note.text|urlizetrunc:25|linebreaks }}
                        </div>
                        {% if note.attached_image %}
				            <img src="{{ note.attached_image.static_image_url }}" />
				        {% endif %}
				        {% if note.video %}
				            <a href="{{ note.video }}" target="_blank">
				                <img src="{{ note.video_thumbnail }}">
				            </a>
				        {% endif %}
                    </div>
                </li>
            </ul>
        </div><!-- btn -->
        
        {% include 'cosinnus/media_tags_readonly.html' with object=note %}

        
        {% comment %} -------  Comments ------- {% endcomment %}

        
            <div class="fadedown large-space"  >
                        <div type="button" class="btn btn-default dashboard-appwidget-contentline-extra-indented">
                            <ul class="media-list fine-space">
                                <li class="media">
                                    <div class="media-body comment-background  no-vertical-padding">

                                        <ol class="input-area comment-background">
                                            <li class="w100 font11px no-vertical-padding no-horizontal-padding fadedown-clickarea">
                                                    {% comment %} Like count
                                                    <a href="#" class="pull-right nounderline">
                                                        <i class="fa fa-heart"></i>
                                                        3
                                                    </a>
                                                    {% endcomment %}
                                                    <a href="#" class="pull-right nounderline">
                                                        <i class="fa fa-comments"></i>
                                                        {{ note.comments.count }}
                                                    </a>
                                                    {% comment %} Like button
                                                    <a href="#">Empfehlen</a>
                                                    {% endcomment %}
                                                    {% if note.comments.all or user|can_create_objects_in:note.group %}
                                                        <a href="#">Kommentieren</a>
                                                    {% endif %}

                                            </li>
                                        </ol>
                                        {% comment %} Likes display 
                                        <ol class="input-area comment-background">
                                            <li class="w100 font11px no-vertical-padding no-horizontal-padding">
                                                    <i class="fa fa-heart"></i>
                                                    <a href="#">Simon Liedtke</a>
                                                    empfiehlt das
                                            </li>
                                        </ol>
                                        {% endcomment %}
                                    </div>
                                </li>
                            </ul>
                        </div><!-- btn -->
                        
                        <div style="display:none;">
                        {% for comment in note.comments.all %}
                        
	                        <div type="button" class="btn btn-default dashboard-appwidget-contentline-extra-indented">
	                            <ul class="media-list {% if not forloop.last %}fine-space{% endif %}">
	                                <li class="media">
	                                    <a class="pull-left" href="{{ comment.creator.cosinnus_profile.get_absolute_url }}">
	                                        {% include 'cosinnus/user/user_avatar_image.html' with user=comment.creator %}
	                                    </a>
	                                    <div class="media-body comment-background">
	                                        <strong><a href="{{ comment.creator.cosinnus_profile.get_absolute_url }}">{{ comment.creator|full_name }}</a></strong>
	                                        <div class="font11px regular-space">
	                                            {% if user|has_write_access:comment %}
	                                                <form id="delete_comment_form_{{ comment.pk }}" action="{% url 'cosinnus:note:comment-delete' group=comment.note.group.slug pk=comment.pk %}" method="post" class="form-horizontal">
	                                                    {% csrf_token %}
	                                                    <a class="pull-right" href="#" onclick="$('#delete_comment_form_{{ comment.pk }}').submit(); return false;" title="{% trans "Löschen" %}">[X]</a>
	                                                </form>
	                                            {% endif %}
	                                            <span class="moment-data-date" data-date="{{ comment.created_on|date:'c' }}" ></span>
	                                        </div>
	                                        <p class="comment-background">{{ comment.text|linebreaksbr }}</p>
	                                        
	                                    </div>
	                                </li>
	                            </ul>
	                        </div><!-- btn -->
                        
                        {% endfor %}
                        
                        {% if user|can_create_objects_in:note.group %}
                            <form action="{% url 'cosinnus:note:comment' group=note.group.slug note_slug=note.slug %}" method="post" class="form-horizontal">
				                {% csrf_token %}
                        
		                        <div type="button" class="btn btn-default dashboard-appwidget-contentline-extra-indented">
		                            <ul class="media-list">
		                                <li class="media">
		                                    <a class="pull-left" href="{% url 'cosinnus:profile-detail' %}">
		                                        {% include 'cosinnus/user/user_avatar_image.html' with user=user %}
		                                    </a>
		                                    <div class="media-body no-horizontal-padding no-vertical-padding">
		                                        <textarea id="id_text" name="text" class="form-control next-button-is-for-sending autogrow oneline" placeholder="Kommentar schreiben"></textarea>
		                                    </div>
		                                </li>
		                            </ul>
		                        </div><!-- btn -->
		
		                        <button type="submit" class="btn btn-emphasized">
		                            <ul class="media-list">
		                                <li class="media">
		                                    <a class="pull-left" href="#">
		                                        <i class="fa fa-save"></i>
		                                    </a>
		                                    <div class="media-body">
		                                        {% trans "Post" %}
		                                    </div>
		                                </li>
		                            </ul>
		                        </button><!-- btn -->
		                        
                            </form>
                        {% endif %}
                        </div>
        
            </div><!-- fadedown -->

        {% comment %}  
        {% if note.comments.all %}
	        <div>
                {% for comment in note.comments.all %}
                    {{ comment }} <br/>
                    {{ comment.text }} <br/>
                    {% if user|has_write_access:comment %}
                        <form action="{% url 'cosinnus:note:comment-delete' group=comment.note.group.slug pk=comment.pk %}" method="post" class="form-horizontal">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary">Löschen</button>
                        </form>
                    {% endif %}
                    <br/>
                {% endfor %}
	        </div>
        {% endif %}
        
        <div>
            <legend>Kommentar schreiben</legend>
            <form action="{% url 'cosinnus:note:comment' group=note.group.slug note_slug=note.slug %}" method="post" class="form-horizontal">
                {% csrf_token %}
                <textarea cols="10" id="id_text" name="text" rows="4"></textarea>
                <button type="submit" class="btn btn-primary">Erstellen</button>
            </form>
        </div>
        {% endcomment %}
        
        
        {% comment %}  
            Comments can be displayed like this:
            {{ note.comments.count }}
        {% endcomment %}
    {% endfor %}
  
{% else %}
    <div type="button" class="btn btn-emphasized dashboard-appwidget-contentline fine-space">
        <ul class="media-list">
            <li class="media">
                <a class="pull-left" href="#">
                    <i class="fa fa-tasks"></i>
                </a>
                <div class="media-body">
                    {% trans "There are news posts yet" %}
                </div>
            </li>
        </ul>
    </div><!-- btn -->
{% endif %}

